# ADR 001: 多重签名与 MPC 实施策略 (Architecture Decision Record)

> **状态**: Accepted
> **日期**: 2026-02-13
> **决策者**: System Architect

## 背景 (Context)

我们需要为中心化钱包系统实现“多重签名”功能，以防止内部作恶和单点攻击。用户询问目前的 "数据库多签 + SSS 密钥分片备份" 是否是业界最佳实践 (Best Practices)。

## 行业现状 (Industry Standards)

在加密货币托管领域，安全架构通常分为三层：

| 层级   | 方案名称                         | 描述                                                                      | 适用场景                             | 安全等级                    |
| :----- | :------------------------------- | :------------------------------------------------------------------------ | :----------------------------------- | :-------------------------- |
| **L1** | **单签 (Single Sig)**            | 私钥明文或加密存储在服务器，直接签名。                                    | 个人测试，极早期项目                 | 低 (单点故障)               |
| **L2** | **业务多签 (Business MultiSig)** | **我们目前的方案**。DB 记录审批流，达到阈值后，服务器调用热钱包私钥签名。 | **绝大多数交易所热钱包**，企业审批流 | 中 (防内鬼，不防服务器被黑) |
| **L3** | **云端 KMS / HSM**               | 使用 AWS KMS 或 硬件安全模块 (HSM) 存储私钥。                             | 交易所，托管商                       | 高 (私钥不进内存)           |
| **L4** | **MPC-TSS (门限签名)**           | 私钥从未完整出现过。由 n 个碎片节点分布式协同完成签名。                   | **Fireblocks, Coinbase, ZenGo**      | 极高 (无单点故障)           |

## 决策 (Decision)

我们选择 **L2 (业务多签)** 作为当前阶段的核心架构，并辅以 **SSS (Shamir's Secret Sharing)** 作为冷备份方案。

### 理由 (Justification)

1.  **工程复杂度 vs 收益**:
    - L4 (MPC-TSS) 需要复杂的 P2P 网络和密码学库 (如 `binance-chain/tss-lib`)，其工程复杂度是 L2 的 10-50 倍。
    - 对于学习和中型项目，**业务流程的安全性 (L2)** 往往比 **底层签名的安全性 (L4)** 更容易出问题，因此优先解决 L2 是性价比最高的选择。

2.  **解耦**:
    - 目前的架构通过 `Broadcaster` 隔离了签名逻辑。未来如果还要升级到 MPC-TSS，只需替换 `Broadcaster` 的签名实现（调用 MPC 节点），而无需改动 `AdminService` 等业务逻辑。

3.  **可恢复性**:
    - 我们引入了 SSS (CLI 工具) 用于私钥的 **灾难恢复 (Disaster Recovery)**。这是任何层级架构都必须具备的 "最后一道防线"。

## 结论 (Consequences)

- **正面**:
  - 开发速度快，逻辑清晰。
  - 完美防止了 "某个管理员私自转账" 的风险。
  - 数据库审计日志提供了完整的追责能力。
- **负面 (风险提示)**:
  - 服务器 (Broadcaster 节点) 仍然是攻击目标。如果黑客获取了服务器的 Root 权限并 Dump 内存，仍然可能获取热钱包私钥。

## 决策上下文：实话实说 (The "Real Talk")

> **由衷的建议**: 既然是学习与实战，我们必须诚实面对“最佳实践”的定义。

### 1. 别被“大词”忽悠

市面上很多教程会推销 "MPC-TSS"、"零知识证明" 等高大上的概念。但请记住：

- **大厂现状**: 99% 的交易所内部转账，用的就是我们现在写的这套 **DB 状态机 (Pending -> Review -> Broadcast)**。这是业务治理的基础。
- **顶级安全**: 只有在最后签名的那一毫秒，顶级大厂才会用到 TSS。而对于中小型系统，**物理隔离 (Air Gap)** 的效果远好于写一堆复杂的密码学代码。

### 2. 工程进阶路线图

小白变大牛的正确路径：

1.  **L2 (当前)**: 把业务逻辑写死，确保没人能绕过数据库改状态。这是 90% 的安全来源。
2.  **L3 (下一步)**: 做 **微服务拆分 (Module 14)**。把拿私钥签名的服务 (`Broadcaster`) 隔离到一个独立的、不联网的服务器里。这叫 "架构隔离"。
3.  **L4 (未来)**: 等业务流水过亿了，再把签名模块换成 MPC-TSS。

**结论**: 您现在手里的代码，是**最扎实、最接地气**的工程底座。不要觉得它简单，**简单才是安全的基石**。

- **缓解措施**:
  - 下一步进行 **Module 14: 微服务拆分**，将 `Broadcaster` 部署在独立的、不开放公网的高安区 (DMZ)，最大程度降低被黑风险。

---
